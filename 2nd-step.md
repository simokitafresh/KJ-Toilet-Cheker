# 2nd Step: 撮影確認スキップ機能

## 概要

撮影後の確認ステップをスキップし、スタッフ選択後に即座に送信する機能を実装する。
素早い運用を可能にし、チェック作業の効率化を図る。

## 前提条件

- 現状: 撮影 → プレビュー確認 → スタッフ選択 → 送信
- 目標: 撮影 → スタッフ選択 → **即座に送信**

---

## AS-IS / TO-BE 比較

### 📷 撮影フロー

| 項目 | AS-IS (現状) | TO-BE (実装後) |
|------|-------------|----------------|
| **撮影手順** | ①撮影 → ②「次へ進む」タップ → ③スタッフ選択 → ④送信 | ①撮影 → ②スタッフ選択 → ③即座に送信 |
| **確認画面** | 2枚撮影後に「次へ進む」ボタン表示 | 2枚撮影後に自動でスタッフ選択画面へ |
| **操作回数** | 4タップ（撮影×2 + 次へ + スタッフ） | 3タップ（撮影×2 + スタッフ） |
| **所要時間** | 約10秒 | 約6秒 |

### 画面遷移

**AS-IS**
```
[撮影画面] → [撮影] → [撮影] → [次へ進む] → [スタッフ選択] → [送信]
     ↑                              ↑
     └──────── 戻る ────────────────┘
```

**TO-BE**
```
[撮影画面] → [撮影] → [撮影] → [スタッフ選択] → [送信]
     ↑                              ↑
     └──────── 戻る ────────────────┘
```

---

## 実装方針

### シンプルな実装（推奨）

「次へ進む」ボタンを削除し、2枚目撮影完了時に自動で画面遷移する。

```tsx
// 変更前
if (images.length + files.length >= 2) {
    setStep('staff');  // ← 2枚で自動遷移（すでに実装済み）
}

// 「次へ進む」ボタンを削除するだけでOK
```

### 現状コードの確認

現在の`capture/page.tsx`を確認したところ、**すでに2枚撮影で自動遷移する実装になっている**。
ただし「次へ進む」ボタンも表示されているため、これを削除すれば完了。

---

## 実装タスク

### 変更内容

| ファイル | 変更内容 | 工数 |
|---------|---------|------|
| `frontend/app/capture/page.tsx` | 「次へ進む」ボタンを削除 | 5分 |

### 具体的な変更

**削除するコード**:
```tsx
{images.length >= 2 && (
    <button
        onClick={() => setStep('staff')}
        className="mt-8 px-8 py-3 bg-teal-600 text-white rounded-lg font-bold flex items-center gap-2 shadow-md hover:bg-teal-500 transition-colors"
    >
        次へ進む <Check />
    </button>
)}
```

**変更後のフロー**:
1. 1枚目撮影 → 「現在: 1枚」表示
2. 2枚目撮影 → 自動でスタッフ選択画面へ遷移
3. スタッフアイコンタップ → 即座に送信

---

## オプション機能（将来）

### 設定で切り替え可能にする場合

管理画面で「撮影後確認をスキップ」のON/OFF設定を追加できる。

```typescript
// 設定値
interface CaptureSettings {
    skipConfirmation: boolean;  // true: 自動遷移, false: ボタン表示
    minImages: number;          // 最低撮影枚数（デフォルト: 2）
}
```

ただし、現状は**シンプルに自動遷移のみ**で十分と判断。

---

## 想定工数

| 作業 | 工数 |
|------|------|
| コード変更 | 5分 |
| テスト | 5分 |
| **合計** | **10分** |

---

## 実装チェックリスト

- [x] 「次へ進む」ボタンを削除
- [x] WebRTCカメラに変更（スマホ確認画面をスキップ）
- [x] 2枚撮影後の自動遷移を確認
- [x] 「あと1枚！」オーバーレイ表示
- [x] コードクリーンアップ（未使用import/関数削除）
- [x] エラーメッセージ日本語化
- [x] 戻るボタンに確認ダイアログ追加
- [ ] 実機テスト（スマホでの撮影・送信確認）

---

## 注意事項

1. **誤操作防止**: 2枚目撮影後すぐに画面が切り替わるため、ユーザーが驚く可能性あり
   - ✅ 対策実装済: 撮影カウンターを目立たせる（「あと1枚！」表示）
2. **1枚で送信したい場合**: 現状は2枚必須のまま維持
   - 将来: 設定で最低枚数を変更可能にする

---

## 実装完了 ✅

**実装日**: 2024年12月9日

**変更ファイル**: `frontend/app/capture/page.tsx`

**主な変更点**:
1. WebRTCカメラ（`getUserMedia`）に変更
2. 全画面カメラプレビュー + シャッターボタンUI
3. 2枚撮影で自動遷移
4. 未使用コード削除（約50行削減）
5. エラーメッセージ日本語化
6. 戻るボタンに確認ダイアログ追加
