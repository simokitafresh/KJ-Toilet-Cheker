# 3rd Step: 管理パネル整理 & スタッフ管理CRUD強化

## 概要

管理パネルから不要なタブを削除し、スタッフ管理を完全なCRUD機能に強化する。
シンプルダッシュボード導入により不要になった機能を削除し、管理画面をスリム化する。

---

## AS-IS / TO-BE 比較

### 🖥️ 管理パネル タブ構成

| 項目 | AS-IS (現状) | TO-BE (実装後) |
|------|-------------|----------------|
| **スタッフ管理** | ✅ 残す（CRUD強化） | 名前編集、アイコン編集、並び替え、論理削除 |
| **トイレ管理** | ✅ 残す | 変更なし |
| **チェックポイント** | ❌ 削除 | シンプルダッシュボードで不要に |
| **システム設定** | ❌ 削除 | 設定はconfig.pyでハードコード済み |

### 👥 スタッフ管理機能

| 機能 | AS-IS (現状) | TO-BE (実装後) |
|------|-------------|----------------|
| **一覧表示** | ✅ アイコン + 名前 + 表示順 | 同様（ドラッグで並び替え可能に） |
| **追加** | ✅ prompt()でシンプル入力 | モーダルでフォーム入力 |
| **編集** | ❌ なし | ✅ 名前・アイコン編集モーダル |
| **並び替え** | ❌ なし | ✅ ドラッグ&ドロップまたは↑↓ボタン |
| **削除** | ✅ 物理削除 | ✅ 論理削除（is_active=false） |
| **復元** | ❌ なし | ✅ 削除済みスタッフの復元 |

---

## 削除対象

### 1. チェックポイント機能（フロントエンド）

**理由**: シンプルダッシュボード（1st-step）で時間設定をハードコードしたため不要

**削除するコード**:
- `frontend/app/admin/page.tsx`:
  - `checkpoints` state
  - `loadCheckpoints()` 関数
  - `openCpModal()`, `saveCheckpoint()`, `deleteCheckpoint()` 関数
  - `isCpModalOpen`, `editingCp` state
  - 「チェックポイント」タブ
  - チェックポイントモーダル

### 2. システム設定機能（フロントエンド）

**理由**: 開院時間等は`backend/app/core/config.py`でハードコード済み

**削除するコード**:
- `frontend/app/admin/page.tsx`:
  - `settings` state
  - `loadSettings()` 関数
  - `updateSettingValue()`, `getSettingValue()` 関数
  - 「システム設定」タブ

### 3. バックエンドAPI（オプション）

**残すか検討**:
- `/admin/major-checkpoints/*` - 将来使う可能性あり → **残す**
- `/admin/settings/*` - 将来使う可能性あり → **残す**

→ **フロントエンドのUIだけ削除し、バックエンドAPIは残す**

---

## スタッフ管理CRUD強化

### 新UI設計

```
┌──────────────────────────────────────────────────────────────┐
│  スタッフ管理                              [+ スタッフ追加]  │
├──────────────────────────────────────────────────────────────┤
│  表示順  アイコン  名前            操作                      │
│  ─────────────────────────────────────────────────           │
│  ↑↓  1    🐶      田中さん        [編集] [削除]             │
│  ↑↓  2    🐱      鈴木さん        [編集] [削除]             │
│  ↑↓  3    🐰      佐藤さん        [編集] [削除]             │
├──────────────────────────────────────────────────────────────┤
│  ▼ 削除済みスタッフを表示                                    │
│     🐻  山田さん（削除済み）      [復元]                     │
└──────────────────────────────────────────────────────────────┘
```

### 編集モーダル

```
┌────────────────────────────────────┐
│  スタッフ編集              [×]    │
├────────────────────────────────────┤
│  名前                              │
│  ┌────────────────────────────┐   │
│  │ 田中さん                   │   │
│  └────────────────────────────┘   │
│                                    │
│  アイコン（絵文字）                │
│  ┌────────────────────────────┐   │
│  │ 🐶                         │   │
│  └────────────────────────────┘   │
│                                    │
│  [保存]                            │
└────────────────────────────────────┘
```

---

## 実装タスク

### Phase 1: 不要機能削除

| ファイル | 変更内容 | 工数 |
|---------|---------|------|
| `frontend/app/admin/page.tsx` | チェックポイントタブ削除 | 10分 |
| `frontend/app/admin/page.tsx` | システム設定タブ削除 | 10分 |
| `frontend/lib/api.ts` | 不要なAPI呼び出し削除（オプション） | 5分 |
| `frontend/lib/types.ts` | MajorCheckpoint型を残す（使用箇所確認） | 5分 |

### Phase 2: スタッフ管理CRUD強化

| ファイル | 変更内容 | 工数 |
|---------|---------|------|
| `frontend/app/admin/page.tsx` | スタッフ編集モーダル追加 | 20分 |
| `frontend/app/admin/page.tsx` | 並び替え機能（↑↓ボタン） | 15分 |
| `frontend/app/admin/page.tsx` | 削除済み表示・復元機能 | 15分 |
| `backend/app/api/admin.py` | 並び替えAPI追加 | 10分 |

---

## API変更

### 新規API: 並び替え

```
PATCH /admin/staff/reorder
Body: { "staff_ids": [3, 1, 2] }  // 新しい順番でIDを送信
```

### 既存API変更

```
GET /admin/staff
→ クエリパラメータ追加: ?include_inactive=true で削除済みも取得

PATCH /admin/staff/{id}
→ is_active を更新可能に（復元用）
```

---

## 想定工数

| Phase | 作業内容 | 工数 |
|-------|---------|------|
| Phase 1 | 不要機能削除 | 30分 |
| Phase 2 | スタッフCRUD強化 | 60分 |
| テスト | 動作確認 | 15分 |
| **合計** | | **1時間45分** |

---

## 実装チェックリスト

### Phase 1: 削除
- [x] チェックポイントタブ・関連コード削除
- [x] システム設定タブ・関連コード削除
- [x] 未使用import削除
- [x] 不要なAPI呼び出し削除（api.ts整理）

### Phase 2: スタッフCRUD強化
- [x] スタッフ編集モーダル実装
- [x] 名前編集機能
- [x] アイコン編集機能
- [x] 並び替え機能（↑↓ボタン）
- [x] 並び替えAPI実装（POST /admin/staff/reorder）
- [x] 削除済みスタッフ表示
- [x] 復元機能
- [ ] 動作確認

---

## 注意事項

1. **バックエンドAPIは残す**: 将来的に設定画面を復活させる可能性があるため、APIエンドポイントは削除しない
2. **論理削除の確認**: 現在のバックエンドは既に論理削除（`is_active=false`）を実装済み
3. **並び替えの永続化**: `display_order`フィールドを使用して順番を保存
