<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ãƒˆã‚¤ãƒ¬ãƒã‚§ãƒƒã‚¯ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; background: #f3f4f6; min-height: 100vh; padding: 24px; }
    .container { max-width: 1200px; margin: 0 auto; }
    .card { background: white; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); padding: 24px; margin-bottom: 24px; }
    h1 { font-size: 1.875rem; color: #1f2937; }
    h2 { font-size: 1.5rem; color: #1f2937; margin-bottom: 16px; }
    h3 { font-size: 1.125rem; color: #374151; margin-bottom: 12px; }
    h4 { font-size: 1rem; color: #374151; font-weight: 600; }
    p { color: #6b7280; margin-top: 8px; }
    .mermaid { background: white; padding: 20px; border-radius: 8px; overflow-x: auto; }
    table { width: 100%; border-collapse: collapse; margin-top: 16px; }
    th, td { border: 1px solid #d1d5db; padding: 8px 16px; text-align: left; }
    th { background: #f9fafb; }
    tr:nth-child(even) { background: #f9fafb; }
    .badge { display: inline-block; padding: 2px 8px; border-radius: 4px; font-size: 0.875rem; }
    .badge-green { background: #d1fae5; color: #065f46; }
    .badge-red { background: #fee2e2; color: #991b1b; }
    .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 24px; }
    .grid-3 { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; }
    .grid-10 { display: grid; grid-template-columns: repeat(10, 1fr); gap: 16px; }
    .api-card { padding: 8px 12px; background: white; border-radius: 4px; margin-bottom: 8px; border-left: 4px solid; }
    .api-post { border-color: #3b82f6; }
    .api-get { border-color: #22c55e; }
    .api-patch { border-color: #eab308; }
    .api-delete { border-color: #ef4444; }
    .api-crud { border-color: #a855f7; }
    .method { font-weight: bold; font-size: 0.875rem; }
    .method-post { color: #3b82f6; }
    .method-get { color: #22c55e; }
    .method-patch { color: #eab308; }
    .method-delete { color: #ef4444; }
    .method-crud { color: #a855f7; }
    code { font-family: monospace; background: #f3f4f6; padding: 2px 6px; border-radius: 4px; }
    .alert { padding: 16px; border-radius: 8px; margin-top: 16px; }
    .alert-yellow { background: #fef3c7; border: 1px solid #fcd34d; }
    .alert-blue { background: #dbeafe; border: 1px solid #93c5fd; }
    .alert-yellow h4 { color: #92400e; }
    .alert-yellow p { color: #a16207; font-size: 0.875rem; }
    .alert-blue h4 { color: #1e40af; }
    .alert-blue ul { color: #1d4ed8; font-size: 0.875rem; margin-top: 8px; padding-left: 20px; }
    .status-card { padding: 16px; border-radius: 8px; text-align: center; }
    .status-green { background: #d1fae5; }
    .status-yellow { background: #fef3c7; }
    .status-red { background: #fee2e2; }
    .icon-grid { padding: 8px; background: #f3f4f6; border-radius: 8px; text-align: center; font-size: 2rem; }
    .tech-card { padding: 16px; border: 1px solid #e5e7eb; border-radius: 8px; }
    .tech-dot { width: 12px; height: 12px; border-radius: 50%; display: inline-block; margin-right: 8px; }
    .tech-dot-blue { background: #3b82f6; }
    .tech-dot-green { background: #22c55e; }
    .tech-dot-purple { background: #a855f7; }
    .tech-dot-orange { background: #f97316; }
    pre { background: #1f2937; color: #4ade80; padding: 12px; border-radius: 8px; overflow-x: auto; font-size: 0.875rem; margin-top: 8px; }
    .section-green { background: #ecfdf5; border: 1px solid #a7f3d0; border-radius: 8px; padding: 16px; }
    .section-red { background: #fef2f2; border: 1px solid #fecaca; border-radius: 8px; padding: 16px; }
    .section-green h3 { color: #065f46; }
    .section-red h3 { color: #991b1b; }
    footer { text-align: center; color: #9ca3af; font-size: 0.875rem; padding: 16px 0; }
    @media (max-width: 768px) {
      .grid-10 { grid-template-columns: repeat(5, 1fr); }
    }
  </style>
</head>
<body>
  <div class="container">
    
    <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
    <header class="card">
      <h1>ãƒˆã‚¤ãƒ¬ãƒã‚§ãƒƒã‚¯ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ </h1>
      <p>ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³ç´°å›³ - ãƒ•ã‚§ãƒ¼ã‚ºAæœ€çµ‚ç‰ˆ</p>
    </header>

    <!-- 1. ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“æ§‹æˆ -->
    <section class="card">
      <h2>1. ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“æ§‹æˆ</h2>
      <div class="mermaid">
flowchart TB
    subgraph Client["ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼ˆãƒ–ãƒ©ã‚¦ã‚¶/PWAï¼‰"]
        C1["/capture\næ’®å½±ç”¨PWA"]
        C2["/dashboard\né–²è¦§ç”¨"]
        C3["/admin\nç®¡ç†ç”»é¢"]
    end
    
    subgraph Render["Render Platform"]
        subgraph Frontend["Next.js (Starter)"]
            NX["Next.js 14+\nApp Router / RSC"]
        end
        
        subgraph Backend["FastAPI (Starter)"]
            FA["FastAPI\nPython 3.11+"]
            AUTH["Basic Auth\nMiddleware"]
        end
        
        subgraph Storage["Storage"]
            PG[("PostgreSQL\nRender Postgres")]
            DISK[("Render Disk\n/var/data/toilet-images")]
        end
    end
    
    C1 -->|èªè¨¼ãªã—| NX
    C2 -->|èªè¨¼ãªã—| NX
    C3 -->|Basicèªè¨¼| NX
    
    NX -->|API Call| FA
    FA --> AUTH
    FA --> PG
    FA --> DISK
      </div>
    </section>

    <!-- 2. ãƒšãƒ¼ã‚¸æ§‹æˆã¨ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° -->
    <section class="card">
      <h2>2. ãƒšãƒ¼ã‚¸æ§‹æˆã¨ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°</h2>
      <div class="mermaid">
flowchart LR
    subgraph Pages["Next.js App Router"]
        direction TB
        ROOT["/"]
        CAP["/capture"]
        DASH["/dashboard"]
        ADM["/admin"]
        
        ROOT --> CAP
        ROOT --> DASH
        ROOT --> ADM
    end
    
    subgraph CaptureDetail["/capture è©³ç´°"]
        CAP1["æ’®å½±ãƒœã‚¿ãƒ³"]
        CAP2["ã‚¢ã‚¤ã‚³ãƒ³é¸æŠ"]
        CAP3["é€ä¿¡å®Œäº†ãƒˆãƒ¼ã‚¹ãƒˆ"]
    end
    
    subgraph DashDetail["/dashboard è©³ç´°"]
        D1["Day View"]
        D2["Week View"]
        D3["Month View"]
    end
    
    subgraph AdminDetail["/admin è©³ç´°"]
        A1["è¨ºç™‚æ™‚é–“è¨­å®š"]
        A2["MAJORè¨­å®š"]
        A3["ã‚¹ã‚¿ãƒƒãƒ•ç®¡ç†"]
        A4["ãƒˆã‚¤ãƒ¬ç®¡ç†"]
    end
    
    CAP --- CaptureDetail
    DASH --- DashDetail
    ADM --- AdminDetail
      </div>
      
      <table>
        <thead>
          <tr>
            <th>ãƒ‘ã‚¹</th>
            <th>èªè¨¼</th>
            <th>ç”¨é€”</th>
            <th>ä¸»ãªæ©Ÿèƒ½</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><code>/capture</code></td>
            <td><span class="badge badge-green">ãªã—</span></td>
            <td>ã‚¹ã‚¿ãƒƒãƒ•æ’®å½±</td>
            <td>ã‚«ãƒ¡ãƒ©èµ·å‹•â†’æ’®å½±â†’ã‚¢ã‚¤ã‚³ãƒ³é¸æŠâ†’é€ä¿¡</td>
          </tr>
          <tr>
            <td><code>/dashboard</code></td>
            <td><span class="badge badge-green">ãªã—</span></td>
            <td>é–²è¦§å°‚ç”¨</td>
            <td>Day/Week/Monthè¡¨ç¤ºã€ã‚¢ãƒ©ãƒ¼ãƒˆç¢ºèª</td>
          </tr>
          <tr>
            <td><code>/admin</code></td>
            <td><span class="badge badge-red">Basicèªè¨¼</span></td>
            <td>ç®¡ç†è€…å°‚ç”¨</td>
            <td>è¨­å®šå¤‰æ›´ã€ã‚¹ã‚¿ãƒƒãƒ•/ãƒˆã‚¤ãƒ¬ç®¡ç†</td>
          </tr>
        </tbody>
      </table>
    </section>

    <!-- 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆ -->
    <section class="card">
      <h2>3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­è¨ˆï¼ˆERå›³ï¼‰</h2>
      <div class="mermaid">
erDiagram
    staff {
        int id PK
        varchar internal_name
        varchar icon_code
        boolean is_active
        int display_order
        timestamp created_at
        timestamp updated_at
    }
    
    toilets {
        int id PK
        varchar name
        varchar floor
        boolean is_active
        timestamp created_at
        timestamp updated_at
    }
    
    devices {
        int id PK
        varchar device_uuid UK
        varchar name
        int assigned_toilet_id FK
        timestamp created_at
    }
    
    toilet_checks {
        int id PK
        int toilet_id FK
        int device_id FK
        int staff_id FK
        timestamp checked_at
        int interval_sec_from_prev
        varchar status_type
        timestamp created_at
    }
    
    check_images {
        int id PK
        int check_id FK
        varchar image_path
        varchar image_type
        int order_index
        timestamp created_at
    }
    
    major_checkpoints {
        int id PK
        varchar name
        time start_time
        time end_time
        int target_toilet_id FK
        boolean is_active
        int display_order
        timestamp created_at
        timestamp updated_at
    }
    
    clinic_config {
        int id PK
        varchar key UK
        varchar value
        timestamp updated_at
    }
    
    toilets ||--o{ toilet_checks : has
    staff ||--o{ toilet_checks : performs
    devices ||--o{ toilet_checks : from
    toilet_checks ||--o{ check_images : contains
    toilets ||--o{ major_checkpoints : target
    toilets ||--o{ devices : assigned
      </div>
    </section>

    <!-- 4. APIè¨­è¨ˆ -->
    <section class="card">
      <h2>4. APIè¨­è¨ˆ</h2>
      
      <div class="grid-2">
        <!-- å…¬é–‹API -->
        <div class="section-green">
          <h3>ğŸ”“ å…¬é–‹APIï¼ˆèªè¨¼ãªã—ï¼‰</h3>
          <div class="api-card api-post">
            <span class="method method-post">POST</span> <code>/api/checks</code>
            <p style="font-size:0.875rem;color:#6b7280;margin:4px 0 0;">ãƒã‚§ãƒƒã‚¯è¨˜éŒ²ï¼ˆç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼‰</p>
          </div>
          <div class="api-card api-get">
            <span class="method method-get">GET</span> <code>/api/checks</code>
            <p style="font-size:0.875rem;color:#6b7280;margin:4px 0 0;">ãƒã‚§ãƒƒã‚¯ä¸€è¦§å–å¾—</p>
          </div>
          <div class="api-card api-get">
            <span class="method method-get">GET</span> <code>/api/dashboard/day</code>
            <p style="font-size:0.875rem;color:#6b7280;margin:4px 0 0;">Day View ãƒ‡ãƒ¼ã‚¿</p>
          </div>
          <div class="api-card api-get">
            <span class="method method-get">GET</span> <code>/api/dashboard/week</code>
            <p style="font-size:0.875rem;color:#6b7280;margin:4px 0 0;">Week View ãƒ‡ãƒ¼ã‚¿</p>
          </div>
          <div class="api-card api-get">
            <span class="method method-get">GET</span> <code>/api/dashboard/month</code>
            <p style="font-size:0.875rem;color:#6b7280;margin:4px 0 0;">Month View ãƒ‡ãƒ¼ã‚¿</p>
          </div>
          <div class="api-card api-get">
            <span class="method method-get">GET</span> <code>/api/toilets</code>
            <p style="font-size:0.875rem;color:#6b7280;margin:4px 0 0;">ãƒˆã‚¤ãƒ¬ä¸€è¦§</p>
          </div>
          <div class="api-card api-get">
            <span class="method method-get">GET</span> <code>/api/staff</code>
            <p style="font-size:0.875rem;color:#6b7280;margin:4px 0 0;">ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§ï¼ˆã‚¢ã‚¤ã‚³ãƒ³ã®ã¿ï¼‰</p>
          </div>
        </div>
        
        <!-- ç®¡ç†API -->
        <div class="section-red">
          <h3>ğŸ” ç®¡ç†APIï¼ˆBasicèªè¨¼å¿…é ˆï¼‰</h3>
          <div class="api-card api-get">
            <span class="method method-get">GET</span> <code>/api/admin/settings</code>
            <p style="font-size:0.875rem;color:#6b7280;margin:4px 0 0;">å…¨è¨­å®šå–å¾—</p>
          </div>
          <div class="api-card api-post">
            <span class="method method-post">POST</span> <code>/api/admin/settings</code>
            <p style="font-size:0.875rem;color:#6b7280;margin:4px 0 0;">è¨­å®šæ›´æ–°</p>
          </div>
          <div class="api-card api-get">
            <span class="method method-get">GET</span> <code>/api/admin/staff</code>
            <p style="font-size:0.875rem;color:#6b7280;margin:4px 0 0;">ã‚¹ã‚¿ãƒƒãƒ•ä¸€è¦§ï¼ˆæœ¬åå«ã‚€ï¼‰</p>
          </div>
          <div class="api-card api-post">
            <span class="method method-post">POST</span> <code>/api/admin/staff</code>
            <p style="font-size:0.875rem;color:#6b7280;margin:4px 0 0;">ã‚¹ã‚¿ãƒƒãƒ•è¿½åŠ </p>
          </div>
          <div class="api-card api-patch">
            <span class="method method-patch">PATCH</span> <code>/api/admin/staff/{id}</code>
            <p style="font-size:0.875rem;color:#6b7280;margin:4px 0 0;">ã‚¹ã‚¿ãƒƒãƒ•æ›´æ–°</p>
          </div>
          <div class="api-card api-delete">
            <span class="method method-delete">DELETE</span> <code>/api/admin/staff/{id}</code>
            <p style="font-size:0.875rem;color:#6b7280;margin:4px 0 0;">ã‚¹ã‚¿ãƒƒãƒ•è«–ç†å‰Šé™¤</p>
          </div>
          <div class="api-card api-crud">
            <span class="method method-crud">CRUD</span> <code>/api/admin/major-checkpoints</code>
            <p style="font-size:0.875rem;color:#6b7280;margin:4px 0 0;">ä¸»è¦ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆç®¡ç†</p>
          </div>
          <div class="api-card api-crud">
            <span class="method method-crud">CRUD</span> <code>/api/admin/toilets</code>
            <p style="font-size:0.875rem;color:#6b7280;margin:4px 0 0;">ãƒˆã‚¤ãƒ¬ç®¡ç†</p>
          </div>
        </div>
      </div>
    </section>

    <!-- 5. æ’®å½±ãƒ•ãƒ­ãƒ¼ -->
    <section class="card">
      <h2>5. æ’®å½±ãƒ•ãƒ­ãƒ¼ï¼ˆ/captureï¼‰</h2>
      <div class="mermaid">
sequenceDiagram
    participant U as ã‚¹ã‚¿ãƒƒãƒ•
    participant C as /capture (PWA)
    participant CAM as ãƒã‚¤ãƒ†ã‚£ãƒ–ã‚«ãƒ¡ãƒ©
    participant API as FastAPI
    participant DB as PostgreSQL
    participant DISK as Render Disk

    U->>C: ã€Œæ’®å½±ã—ã¦è¨˜éŒ²ã€ã‚¿ãƒƒãƒ—
    C->>CAM: input[type=file] èµ·å‹•
    CAM->>U: ã‚«ãƒ¡ãƒ©UIè¡¨ç¤º
    U->>CAM: 2æšä»¥ä¸Šæ’®å½±
    CAM->>C: ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«è¿”å´
    C->>C: Canvas ã§ç¸®å°ï¼ˆ1280px, 75%ï¼‰
    C->>C: ã‚¢ã‚¤ã‚³ãƒ³é¸æŠç”»é¢è¡¨ç¤º
    U->>C: ã‚¢ã‚¤ã‚³ãƒ³ã‚¿ãƒƒãƒ—
    C->>API: POST /api/checks
    API->>API: ç”»åƒæ¤œè¨¼ï¼ˆæœ€ä½2æšï¼‰
    API->>API: intervalè¨ˆç®—ãƒ»statusåˆ¤å®š
    API->>DB: toilet_checks INSERT
    API->>DB: check_images INSERT
    API->>DISK: ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
    API->>C: 200 OK
    C->>U: ãƒˆãƒ¼ã‚¹ãƒˆã€Œè¨˜éŒ²ã—ã¾ã—ãŸã€
    C->>C: ãƒ¡ã‚¤ãƒ³ç”»é¢ã«è‡ªå‹•æˆ»ã‚Š
      </div>
      
      <div class="alert alert-yellow">
        <h4>â±ï¸ 10ç§’ãƒ«ãƒ¼ãƒ«</h4>
        <p>æ’®å½±ãƒœã‚¿ãƒ³ â†’ å®Œäº†ã¾ã§10ç§’ä»¥å†…ã‚’ç›®æ¨™ã€‚ç¢ºèªç”»é¢ãªã—ã€ã‚„ã‚Šç›´ã—æ©Ÿèƒ½ãªã—ã€‚</p>
      </div>
    </section>

    <!-- 6. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ -->
    <section class="card">
      <h2>6. ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯</h2>
      <div class="mermaid">
flowchart TD
    START([æ–°è¦ãƒã‚§ãƒƒã‚¯]) --> GET_PREV[å‰å›ãƒã‚§ãƒƒã‚¯å–å¾—]
    GET_PREV --> HAS_PREV{å‰å›ã‚ã‚Šï¼Ÿ}
    
    HAS_PREV -->|No| NORMAL1[NORMAL\ninterval = NULL]
    HAS_PREV -->|Yes| CALC[intervalè¨ˆç®—\nï¼ˆç§’ï¼‰]
    
    CALC --> CHECK1{interval < 2700?\nï¼ˆ45åˆ†æœªæº€ï¼‰}
    CHECK1 -->|Yes| SHORT[TOO_SHORT\nğŸŸ¡ é»„]
    CHECK1 -->|No| CHECK2{interval <= 5400?\nï¼ˆ90åˆ†ä»¥å†…ï¼‰}
    
    CHECK2 -->|Yes| NORMAL2[NORMAL\nğŸŸ¢ ç·‘]
    CHECK2 -->|No| LONG[TOO_LONG\nğŸ”´ èµ¤]
      </div>
      
      <div class="grid-3" style="margin-top:16px;">
        <div class="status-card status-green">
          <div style="font-size:2rem;margin-bottom:8px;">ğŸŸ¢</div>
          <div style="font-weight:bold;color:#065f46;">NORMAL</div>
          <div style="font-size:0.875rem;color:#047857;">45ã€œ90åˆ†ä»¥å†…</div>
        </div>
        <div class="status-card status-yellow">
          <div style="font-size:2rem;margin-bottom:8px;">ğŸŸ¡</div>
          <div style="font-weight:bold;color:#92400e;">TOO_SHORT</div>
          <div style="font-size:0.875rem;color:#a16207;">45åˆ†æœªæº€</div>
        </div>
        <div class="status-card status-red">
          <div style="font-size:2rem;margin-bottom:8px;">ğŸ”´</div>
          <div style="font-weight:bold;color:#991b1b;">TOO_LONG</div>
          <div style="font-size:0.875rem;color:#dc2626;">90åˆ†è¶…é</div>
        </div>
      </div>
      
      <div class="alert alert-blue" style="margin-top:16px;">
        <h4>ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚¢ãƒ©ãƒ¼ãƒˆ</h4>
        <ul>
          <li>âš ï¸ 75åˆ†çµŒé â†’ è­¦å‘Šè¡¨ç¤º</li>
          <li>ğŸ”´ 90åˆ†çµŒé â†’ ã‚¢ãƒ©ãƒ¼ãƒˆè¡¨ç¤º</li>
        </ul>
      </div>
    </section>

    <!-- 7. ä¸»è¦ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆï¼ˆMAJORï¼‰ -->
    <section class="card">
      <h2>7. ä¸»è¦ãƒã‚§ãƒƒã‚¯ãƒã‚¤ãƒ³ãƒˆï¼ˆMAJORï¼‰</h2>
      
      <table>
        <thead>
          <tr>
            <th>ãƒ©ãƒ™ãƒ«</th>
            <th>ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ™‚é–“å¸¯</th>
            <th>èª¬æ˜</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><strong>é–‹é™¢å‰</strong></td>
            <td><code>08:30â€“08:50</code></td>
            <td>é–‹é™¢æº–å‚™ã¨ã—ã¦å¿…é ˆ</td>
          </tr>
          <tr>
            <td><strong>åˆå‰çµ‚äº†æ™‚</strong></td>
            <td><code>12:00â€“13:00</code></td>
            <td>æ˜¼ä¼‘ã¿å‰ã®ç¢ºèª</td>
          </tr>
          <tr>
            <td><strong>åˆå¾Œé–‹å§‹å‰</strong></td>
            <td><code>14:40â€“14:50</code></td>
            <td>åˆå¾Œè¨ºç™‚é–‹å§‹å‰</td>
          </tr>
          <tr>
            <td><strong>é–‰é™¢æ™‚</strong></td>
            <td><code>19:30â€“20:30</code></td>
            <td>é–‰é™¢æ™‚ã®æœ€çµ‚ç¢ºèª</td>
          </tr>
        </tbody>
      </table>
      
      <div class="mermaid" style="margin-top:16px;">
flowchart LR
    subgraph çŠ¶æ…‹åˆ¤å®š
        TIME([ç¾åœ¨æ™‚åˆ»])
        TIME --> B1{æ™‚é–“å¸¯å‰ï¼Ÿ}
        B1 -->|Yes| S1[â³ ã¾ã ]
        B1 -->|No| B2{æ™‚é–“å¸¯å†…ï¼Ÿ}
        B2 -->|Yes| B3{ãƒã‚§ãƒƒã‚¯ã‚ã‚Šï¼Ÿ}
        B3 -->|Yes| S2[âœ… å®Œäº†]
        B3 -->|No| S1
        B2 -->|No| B4{ãƒã‚§ãƒƒã‚¯ã‚ã£ãŸï¼Ÿ}
        B4 -->|Yes| S2
        B4 -->|No| S3[ğŸ”´ æœªå®Ÿæ–½]
    end
      </div>
    </section>

    <!-- 8. ã‚¹ã‚¿ãƒƒãƒ•ã‚¢ã‚¤ã‚³ãƒ³ -->
    <section class="card">
      <h2>8. ã‚¹ã‚¿ãƒƒãƒ•ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆ20ç¨®é¡ï¼‰</h2>
      
      <div class="grid-10" style="margin-bottom:24px;">
        <div class="icon-grid">ğŸ¶</div>
        <div class="icon-grid">ğŸ±</div>
        <div class="icon-grid">ğŸ­</div>
        <div class="icon-grid">ğŸ¹</div>
        <div class="icon-grid">ğŸ°</div>
        <div class="icon-grid">ğŸ¦Š</div>
        <div class="icon-grid">ğŸ»</div>
        <div class="icon-grid">ğŸ¼</div>
        <div class="icon-grid">ğŸ¨</div>
        <div class="icon-grid">ğŸ¯</div>
        <div class="icon-grid">ğŸ¦</div>
        <div class="icon-grid">ğŸ®</div>
        <div class="icon-grid">ğŸ·</div>
        <div class="icon-grid">ğŸ¸</div>
        <div class="icon-grid">ğŸµ</div>
        <div class="icon-grid">ğŸ”</div>
        <div class="icon-grid">ğŸ§</div>
        <div class="icon-grid">ğŸ¦</div>
        <div class="icon-grid">ğŸ¦†</div>
        <div class="icon-grid">ğŸ¦‰</div>
      </div>
      
      <div class="alert alert-blue">
        <h4>é‹ç”¨ãƒ«ãƒ¼ãƒ«</h4>
        <ul>
          <li>å„ã‚¹ã‚¿ãƒƒãƒ•ã«1ã¤ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’å‰²ã‚Šå½“ã¦ï¼ˆãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ï¼‰</li>
          <li>æ’®å½±ç”»é¢ãƒ»ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ã¯ã‚¢ã‚¤ã‚³ãƒ³ã®ã¿è¡¨ç¤º</li>
          <li>adminç”»é¢ã§ã®ã¿ internal_name ã¨ã®ç´ä»˜ã‘ã‚’ç¢ºèªå¯èƒ½</li>
        </ul>
      </div>
    </section>

    <!-- 9. ç”»åƒä¿å­˜ -->
    <section class="card">
      <h2>9. ç”»åƒä¿å­˜ãƒ•ãƒ­ãƒ¼</h2>
      <div class="mermaid">
flowchart LR
    subgraph Client["ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ"]
        IMG1[æ’®å½±ç”»åƒ\nã‚ªãƒªã‚¸ãƒŠãƒ«]
        CANVAS[Canvasç¸®å°\n1280px / 75%]
        IMG2[ç¸®å°ç”»åƒ\n100-200KB]
    end
    
    subgraph Server["ã‚µãƒ¼ãƒ"]
        RECV[ç”»åƒå—ä¿¡]
        VALID[æ¤œè¨¼\næœ€ä½2æš]
        SAVE[ãƒ‡ã‚£ã‚¹ã‚¯ä¿å­˜]
    end
    
    subgraph Disk["Render Disk"]
        PATH["/var/data/toilet-images\n/YYYY/MM/DD/check_id/"]
    end
    
    IMG1 --> CANVAS --> IMG2
    IMG2 -->|Upload| RECV
    RECV --> VALID --> SAVE --> PATH
      </div>
      
      <div class="grid-2" style="margin-top:16px;">
        <div style="background:#f9fafb;padding:16px;border-radius:8px;">
          <h4>ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ</h4>
          <pre>/var/data/toilet-images/
â””â”€â”€ 2024/
    â””â”€â”€ 01/
        â””â”€â”€ 15/
            â””â”€â”€ 42/           # check_id
                â”œâ”€â”€ 0_sheet.jpg
                â”œâ”€â”€ 1_overview.jpg
                â””â”€â”€ 2_extra.jpg  # ã‚ªãƒ—ã‚·ãƒ§ãƒ³</pre>
        </div>
        <div style="background:#f9fafb;padding:16px;border-radius:8px;">
          <h4>ğŸ“Š å®¹é‡è¦‹ç©ã‚‚ã‚Š</h4>
          <table style="margin-top:8px;">
            <tr><td>1ãƒã‚§ãƒƒã‚¯</td><td style="text-align:right;">200ã€œ800KB</td></tr>
            <tr><td>1æ—¥ï¼ˆ10å›ï¼‰</td><td style="text-align:right;">2ã€œ8MB</td></tr>
            <tr><td>1ãƒ¶æœˆ</td><td style="text-align:right;">60ã€œ240MB</td></tr>
            <tr style="font-weight:bold;"><td>ä¿æŒæœŸé–“</td><td style="text-align:right;">ç„¡æœŸé™</td></tr>
          </table>
        </div>
      </div>
    </section>

    <!-- 10. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯ -->
    <section class="card">
      <h2>10. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯</h2>
      
      <div class="grid-2">
        <div style="display:flex;flex-direction:column;gap:16px;">
          <div class="tech-card">
            <h4><span class="tech-dot tech-dot-blue"></span>ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰</h4>
            <ul style="margin-top:8px;padding-left:20px;color:#6b7280;font-size:0.875rem;">
              <li>Next.js 14+ (App Router)</li>
              <li>React Server Components</li>
              <li>next-pwa</li>
              <li>TailwindCSS</li>
            </ul>
          </div>
          
          <div class="tech-card">
            <h4><span class="tech-dot tech-dot-green"></span>ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰</h4>
            <ul style="margin-top:8px;padding-left:20px;color:#6b7280;font-size:0.875rem;">
              <li>FastAPI (Python 3.11+)</li>
              <li>SQLAlchemy</li>
              <li>Pydantic</li>
              <li>Pillowï¼ˆç”»åƒå‡¦ç†ï¼‰</li>
            </ul>
          </div>
        </div>
        
        <div style="display:flex;flex-direction:column;gap:16px;">
          <div class="tech-card">
            <h4><span class="tech-dot tech-dot-purple"></span>ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</h4>
            <ul style="margin-top:8px;padding-left:20px;color:#6b7280;font-size:0.875rem;">
              <li>PostgreSQL (Render Postgres)</li>
              <li>ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³: Asia/Tokyoå›ºå®š</li>
            </ul>
          </div>
          
          <div class="tech-card">
            <h4><span class="tech-dot tech-dot-orange"></span>ã‚¤ãƒ³ãƒ•ãƒ©</h4>
            <ul style="margin-top:8px;padding-left:20px;color:#6b7280;font-size:0.875rem;">
              <li>Render (Starter Plan)</li>
              <li>Render Diskï¼ˆç”»åƒä¿å­˜ï¼‰</li>
              <li>ç’°å¢ƒå¤‰æ•°ã§Basicèªè¨¼ç®¡ç†</li>
            </ul>
          </div>
        </div>
      </div>
    </section>

    <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
    <footer>
      ãƒˆã‚¤ãƒ¬ãƒã‚§ãƒƒã‚¯ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£å›³ - ãƒ•ã‚§ãƒ¼ã‚ºAæœ€çµ‚ç‰ˆ
    </footer>
    
  </div>

  <!-- Mermaid ã‚’ body æœ«å°¾ã§èª­ã¿è¾¼ã¿ãƒ»åˆæœŸåŒ– -->
  <script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
    mermaid.initialize({ 
      startOnLoad: true,
      theme: 'default',
      flowchart: { useMaxWidth: true, htmlLabels: true },
      sequence: { useMaxWidth: true }
    });
  </script>
</body>
</html>
